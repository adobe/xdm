{
  "meta:license": [
    "Copyright 2025 Adobe Systems Incorporated. All rights reserved.",
    "This work is licensed under a Creative Commons Attribution 4.0 International (CC BY 4.0) license",
    "you may not use this file except in compliance with the License. You may obtain a copy",
    "of the License at https://creativecommons.org/licenses/by/4.0/"
  ],
  "$id": "https://ns.adobe.com/experience/customerJourneyManagement/message-export",
  "title": "Adobe CJM ExperienceEvent - Message Export",
  "description": "Schema for storing the rendered message content for outbound channels in Adobe Journey Optimizer",
  "type": "object",
  "meta:extensible": true,
  "meta:abstract": true,
  "meta:intendedToExtend": ["https://ns.adobe.com/xdm/context/experienceevent"],
  "allOf": [
    {
      "$ref": "https://ns.adobe.com/xdm/data/record"
    },
    {
      "properties": {
        "https://ns.adobe.com/experience/customerJourneyManagement/messageExport/identityMap": {
          "title": "Identity Map",
          "description": "Map containing identifiers for the profile across different identity namespaces",
          "$ref": "https://ns.adobe.com/xdm/context/identitymap"
        },
        "https://ns.adobe.com/experience/customerJourneyManagement/messageExport/messageExecution": {
          "type": "object",
          "title": "Adobe CJM ExperienceEvent - Message Execution Details",
          "description": "Message Execution details for the Adobe CJM ExperienceEvent.",
          "$ref": "https://ns.adobe.com/experience/customerJourneyManagement/messageexecution"
        },
        "https://ns.adobe.com/experience/customerJourneyManagement/messageExport/messageProfile": {
          "type": "object",
          "title": "Adobe CJM ExperienceEvent - Message Profile Details",
          "description": "Message Profile details for the Adobe CJM ExperienceEvent.",
          "$ref": "https://ns.adobe.com/experience/customerJourneyManagement/messageProfile"
        },
        "https://ns.adobe.com/experience/customerJourneyManagement/messageExport/message": {
          "type": "object",
          "title": "Message Details",
          "description": "Details of the rendered message",
          "properties": {
            "messageDetails": {
              "type": "object",
              "title": "Message Details",
              "description": "Contains the specific content details for the message, varying by channel (e.g., email or SMS).",
              "oneOf": [
                {
                  "properties": {
                    "emailDetails": {
                      "type": "object",
                      "title": "Email Content Details",
                      "description": "Specific details for an email message.",
                      "properties": {
                        "type": {
                          "type": "string",
                          "const": "email",
                          "description": "Discriminator field indicating the type of content."
                        },
                        "recipient": {
                          "type": "object",
                          "properties": {
                            "email": {
                              "type": "string",
                              "format": "email"
                            },
                            "name": {
                              "type": "string"
                            },
                            "bcc": {
                              "type": "string",
                              "format": "email"
                            }
                          },
                          "required": ["email"]
                        },
                        "sender": {
                          "type": "object",
                          "properties": {
                            "email": {
                              "type": "string",
                              "format": "email"
                            },
                            "name": {
                              "type": "string"
                            },
                            "errorEmail": {
                              "type": "string",
                              "format": "email"
                            },
                            "replyToEmail": {
                              "type": "string",
                              "format": "email"
                            },
                            "replyToName": {
                              "type": "string"
                            }
                          },
                          "required": ["email, errorEmail, replyToEmail"]
                        },
                        "content": {
                          "type": "object",
                          "properties": {
                            "subject": {
                              "type": "string"
                            },
                            "html": {
                              "type": "string"
                            },
                            "text": {
                              "type": "string"
                            }
                          }
                        }
                      },
                      "required": ["type", "recipient", "sender", "content"]
                    }
                  }
                },
                {
                  "properties": {
                    "smsDetails": {
                      "type": "object",
                      "title": "SMS Content Details",
                      "description": "Specific details for an SMS message.",
                      "properties": {
                        "type": {
                          "type": "string",
                          "const": "sms",
                          "description": "Discriminator field indicating the type of content."
                        },
                        "recipient": {
                          "type": "object",
                          "properties": {
                            "number": {
                              "type": "string",
                              "description": "Recipient's phone number, preferably E.164 format"
                            }
                          },
                          "required": ["number"]
                        },
                        "sender": {
                          "type": "object",
                          "properties": {
                            "number": {
                              "type": "string",
                              "description": "Sender's phone number or short code."
                            }
                          },
                          "required": ["number"]
                        },
                        "content": {
                          "type": "object",
                          "properties": {
                            "title": {
                              "type": "string",
                              "description": "Optional title for the SMS, might be used by some aggregators or for internal tracking."
                            },
                            "message": {
                              "type": "string",
                              "description": "The text content of the SMS message."
                            },
                            "media": {
                              "type": "string",
                              "description": "The media content of the message."
                            }
                          },
                          "required": ["message"]
                        }
                      },
                      "required": ["type", "recipient", "sender", "content"]
                    }
                  }
                }
              ]
            }
          }
        }
      },
      "required": [
        "https://ns.adobe.com/experience/customerJourneyManagement/messageExport/identityMap",
        "https://ns.adobe.com/experience/customerJourneyManagement/messageExport/messageExecution",
        "https://ns.adobe.com/experience/customerJourneyManagement/messageExport/message"
      ]
    }
  ]
}