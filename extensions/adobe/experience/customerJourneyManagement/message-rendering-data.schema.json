{
  "meta:license": [
    "Copyright 2025 Adobe Systems Incorporated. All rights reserved.",
    "This work is licensed under a Creative Commons Attribution 4.0 International (CC BY 4.0) license",
    "you may not use this file except in compliance with the License. You may obtain a copy",
    "of the License at https://creativecommons.org/licenses/by/4.0/"
  ],
  "$id": "https://ns.adobe.com/experience/customerJourneyManagement/message-rendering-data",
  "$schema": "http://json-schema.org/draft-06/schema#",
  "title": "Message Rendering Data",
  "description": "Schema for storing the context data required to render a message in Adobe Journey Optimizer",
  "type": "object",
  "meta:extensible": true,
  "meta:abstract": true,
  "meta:extends": ["https://ns.adobe.com/xdm/data/time-series"],
  "definitions": {
    "message-rendering-data": {
      "properties": {
        "https://ns.adobe.com/experience/customerJourneyManagement/messageRenderingData": {
          "title": "Message Rendering Data",
          "description": "Data related to message rendering in Journey Optimizer",
          "oneOf": [
            {
              "type": "object",
              "properties": {
                "MessageRenderingContext": {
                  "type": "object",
                  "title": "Message Rendering Context",
                  "description": "A map of namespace identifiers to stringified JSON representations of context objects used in template rendering and personalization",
                  "properties": {
                    "type": {
                      "type": "string",
                      "const": "rendering-context",
                      "description": "Discriminator field indicating this is rendering context data"
                    },
                    "renderingContext": {
                      "type": "object",
                      "title": "Rendering Context Map",
                      "description": "A map of namespace identifiers to stringified JSON representations of context objects",
                      "properties": {
                        "profile": {
                          "type": "string",
                          "title": "Profile Context",
                          "description": "Stringified JSON of profile attributes accessed via the 'profile' namespace in templates"
                        },
                        "offer": {
                          "type": "string",
                          "title": "Offer Context",
                          "description": "Stringified JSON of offer decision information accessed via the 'offer' namespace in templates"
                        },
                        "context": {
                          "type": "string",
                          "title": "Context",
                          "description": "Stringified JSON of context variables for general purpose use"
                        },
                        "propertiesContext": {
                          "type": "string",
                          "title": "Properties Context",
                          "description": "Stringified JSON of Journey Optimizer properties and configuration settings for the message"
                        },
                        "decisionPolicy": {
                          "type": "string",
                          "title": "Decision Policy Context",
                          "description": "Stringified JSON of decision policy information for offer decisioning"
                        },
                        "offerContentAttributes": {
                          "type": "string",
                          "title": "Offer Content Attributes",
                          "description": "Stringified JSON of attributes related to offer content"
                        },
                        "url": {
                          "type": "string",
                          "title": "URL Context",
                          "description": "Stringified JSON of URL-related information for link tracking and management"
                        },
                        "fragment": {
                          "type": "string",
                          "title": "Fragment Context",
                          "description": "Stringified JSON of content fragments that can be inserted into templates"
                        },
                        "externalDataLookup": {
                          "type": "string",
                          "title": "External Data Lookup",
                          "description": "Stringified JSON of context for external data lookups during rendering"
                        },
                        "url-support": {
                          "type": "string",
                          "title": "URL Support",
                          "description": "Stringified JSON of URL-related information for link tracking and management"
                        },
                        "inputSchema": {
                          "type": "string",
                          "title": "Input Schema",
                          "description": "Stringified JSON of URL-related information for link tracking and management"
                        },
                        "channelConfiguration": {
                          "type": "string",
                          "title": "Channel Configuration",
                          "description": "Stringified JSON of URL-related information for link tracking and management"
                        },
                        "segment": {
                          "type": "string",
                          "title": "Segment Context",
                          "description": "Stringified JSON of URL-related information for link tracking and management"
                        },
                        "_cjmProperties": {
                          "type": "string",
                          "title": "CJM Properties",
                          "description": "Stringified JSON of internal properties used by the CJM rendering engine"
                        }
                      }
                    },
                    "retrievedEntities": {
                      "type": "array",
                      "title": "Retrieved Entities",
                      "description": "An array of stringified JSON representations of entities retrieved during dynamic entity hydration",
                      "items": {
                        "type": "string",
                        "description": "Stringified JSON representing a retrieved entity's data"
                      }
                    }
                  },
                  "required": ["type", "renderingContext"]
                }
              }
            },
            {
              "type": "object",
              "properties": {
                "MessageRenderedContent": {
                  "type": "object",
                  "title": "Message Rendered Content",
                  "description": "The rendered content for a specific channel",
                  "properties": {
                    "type": {
                      "type": "string",
                      "const": "rendered-content",
                      "description": "Discriminator field indicating this is rendered content data"
                    },
                    "renderedContent": {
                      "title": "Rendered Channel Content",
                      "description": "Channel-specific rendered content",
                      "$ref": "https://ns.adobe.com/experience/customerJourneyManagement/message-rendered-content"
                    }
                  },
                  "required": ["type", "renderedContent"]
                }
              }
            }
          ]
        }
      }
    }
  },
  "allOf": [
    {
      "$ref": "https://ns.adobe.com/xdm/data/time-series"
    },
    {
      "$ref": "#/definitions/message-rendering-data"
    }
  ],
  "meta:status": "stable"
}
