{
    "meta:license": [
        "Copyright 2018 Adobe Systems Incorporated. All rights reserved.",
        "This work is licensed under a Creative Commons Attribution 4.0 International (CC BY 4.0) license",
        "you may not use this file except in compliance with the License. You may obtain a copy",
        "of the License at https://creativecommons.org/licenses/by/4.0/"
    ],
    "$schema": "http://json-schema.org/draft-06/schema#",
    "$id": "https://ns.adobe.com/experience/offer-management/filter-expression",
    "meta:abstract": false,
    "meta:extensible": true,
    "type": "object",
    "title": "Filter Expression Tree",
    "description": "Represents an abstract syntax tree comprised of various node types. The expression is used to evaluate a match against a XDM object tree, where the result is a boolean value - matches: yes or no - or another XDM tree structure.",
    "definitions": {
        "node-type": {
            "type": "string",
            "title": "Node Type",
            "description": "Indicates the type of a node.",
            "enum": [
                "fnApply",
                "fnCreate",
                "literal",
                "fieldLookup",
                "quantification",
                "select",
                "varDecl",
                "varRef"
            ],
            "meta:enum": {
                "fnApply": "Apply a function to the evaluation context. The valency or arity of the function varies with the function-type. Functions can be boolean-valued or produce scalar values and vectors.",
                "fnCreate": "Create a function.",
                "literal": "Produce a value from a literal.",
                "fieldLookup": "Produce a value from an object by accessing one of its fields.",
                "quantification": "Verify how many objects in a set satisfy the provided condition.",
                "select": "Produce a list from a list of inputs by evaluating a projection and a selection expression for every element of the input list.",
                "varDecl": "Sub-structure of the select expression that binds a variable to the elements matching a projection and a selection expression. The value is made available for reference via a variable name to other sub-select expressions.",
                "varRef": "Iterate over a list of values by referencing a variable name that denotes a list element previously qualified (evaluated in preceding variable varDecl)."
            }
        },
        "function-type": {
            "type": "string",
            "title": "Function Identifier",
            "description": "Function Identifier. See allowed values for details.",
            "enum": [
                "and",
                "or",
                "=",
                "!=",
                ">",
                ">=",
                "<=",
                "<",
                "in",
                "notIn",
                "isNull",
                "isNotNull",
                "modelInstances"
            ],
            "meta:enum": {
                "and": "An n-ary AND function. Map a list of boolean values to a single boolean value. Produces 'true' if and only if all input values are 'true', otherwise produces 'false'.",
                "or": "An n-ary OR function. Map a list of boolean values to a single boolean value. Produces 'true' if and only if any of the input values is 'true', otherwise produces 'false'.",
                "=": "Produce a boolean value from two input values by comparing them and returning true if neither value is null and they are equal and returns false otherwise. The second value is coerced to the type of the first value before applying the = operator.",
                "!=": "Produce a boolean value from two input values by comparing them and returning true if neither value is null and they are not equal and returns false otherwise. The second value is coerced to the type of the first value before applying the != operator.",
                ">": "Produce a boolean value from two input values by comparing them and returning true if neither value is null and the first one is greater than the second and returns false otherwise. The second value is coerced to the type of the first value before applying the > operator.",
                ">=": "Produce a boolean value from two input values by comparing them and returning true if neither value is null and the first one is greater than or equals the second and returns false otherwise. The second value is coerced to the type of the first value before applying the >= operator.",
                "<=": "Produce a boolean value from two input values by comparing them and returning true if neither value is null and the first one is less than or equals the second and returns false otherwise. The second value is coerced to the type of the first value before applying the <= operator.",
                "<": "Produce a boolean value from two input values by comparing them and returning true if neither value is null and the first one is less than the second and returns false otherwise. The second value is coerced to the type of the first value before applying the < operator.",
                "in": "Produce a boolean value from a scalar and a vector input value. If the scalar is equal to one or more of the vector values the evaluation results in the boolean value 'true' and 'false' otherwise. The second value is coerced to a list type of the first value before applying the equality check operator.",
                "notIn": "Produce a boolean value from a scalar and a vector input value. If the scalar is equal to none of the vector values the evaluation results in the boolean value 'true' and 'false' otherwise. The second value is coerced to a list type of the first value before applying the equality check operator.",
                "isNull": "Produce a boolean value from a scalar input value. If the scalar is null, the evaluation results in the boolean value 'true' and 'false' otherwise",
                "isNotNull": "Produce a boolean value from a scalar input value. If the scalar is not null, the evaluation results in the boolean value 'true' and 'false' otherwise",
                "modelInstances": "Reference the set of all instances of a given model"
            }
        },
        "literal-type": {
            "type": "string",
            "title": "Literal Type Identifier",
            "description": "Literal Type Identifier: String, Number, Integer, Boolean, Date, DateTime, XDMObject.",
            "enum": [
                "String",
                "Number",
                "Integer",
                "Boolean",
                "List",
                "XDMObject"
            ],
            "meta:enum": {
                "String": "A string literal",
                "Number": "A number literal",
                "Integer": "An integer literal",
                "Boolean": "A boolean literal",
                "List": "An array of literals",
                "XDMObject": "A string denoting a reference of an XDM schema."
            }
        },
        "quantifier-type": {
            "type": "string",
            "title": "Quantifier Type Identifier",
            "description": "Quantifier of first order logic. Produce a boolean value from a list of values by applying a predicate to each item and returning true or false based on the quantifier.",
            "enum": [
                "all",
                "some",
                "none",
                "one"
            ],
            "meta:enum": {
                "all": "The All quantifier",
                "some": "The Exists quantifier",
                "none": "The negated Exists quantifier. 'There does not exist one'",
                "one": "There exists one and only one."
            }
        },
        "function-application-content": {
            "type": "object",
            "title": "N-ary Function Application",
            "description": "Apply an n-ary function (functor) that maps a value (scalar, object, list, tree) to another value, by recursively applying its child nodes to the objects and then taking the results as parameters to itself.",
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "nodeType": {
                            "$ref": "#/definitions/node-type"
                        },
                        "fnName": {
                            "$ref": "#/definitions/function-type"
                        }
                    },
                    "required": [
                        "nodeType",
                        "fnName"
                    ]
                },
                {
                    "oneOf": [
                        {
                            "$ref": "#/definitions/function-content-and"
                        },
                        {
                            "$ref": "#/definitions/function-content-or"
                        },
                        {
                            "$ref": "#/definitions/function-content-equals-native"
                        },
                        {
                            "$ref": "#/definitions/function-content-not-equals-native"
                        },
                        {
                            "$ref": "#/definitions/function-content-greater-than-native"
                        },
                        {
                            "$ref": "#/definitions/function-content-greater-than-or-equal-native"
                        },
                        {
                            "$ref": "#/definitions/function-content-less-than-or-equal-native"
                        },
                        {
                            "$ref": "#/definitions/function-content-less-than-native"
                        },
                        {
                            "$ref": "#/definitions/function-content-in"
                        },
                        {
                            "$ref": "#/definitions/function-content-not-in"
                        },
                        {
                            "$ref": "#/definitions/function-content-null"
                        },
                        {
                            "$ref": "#/definitions/function-content-not-null"
                        },
                        {
                            "$ref": "#/definitions/function-content-model-instances"
                        }
                    ]
                }
            ]
        },
        "function-content-and": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "and"
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 1
                }
            },
            "additionalProperties": false
        },
        "function-content-or": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "or"
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 1
                }
            },
            "additionalProperties": false
        },
        "function-content-equals-native": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "="
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 2,
                    "maxItems": 2
                }
            },
            "additionalProperties": false
        },
        "function-content-not-equals-native": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "!="
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 2,
                    "maxItems": 2
                }
            },
            "additionalProperties": false
        },
        "function-content-greater-than-native": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": ">"
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 2,
                    "maxItems": 2
                }
            },
            "additionalProperties": false
        },
        "function-content-greater-than-or-equal-native": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": ">="
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 2,
                    "maxItems": 2
                }
            },
            "additionalProperties": false
        },
        "function-content-less-than-or-equal-native": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "<="
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 2,
                    "maxItems": 2
                }
            },
            "additionalProperties": false
        },
        "function-content-less-than-native": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "<"
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 2,
                    "maxItems": 2
                }
            },
            "additionalProperties": false
        },
        "function-content-in": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "in"
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 2,
                    "maxItems": 2
                }
            },
            "additionalProperties": false
        },
        "function-content-not-in": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "notIn"
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 2,
                    "maxItems": 2
                }
            },
            "additionalProperties": false
        },
        "function-content-null": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "isNull"
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 1,
                    "maxItems": 1
                }
            },
            "additionalProperties": false
        },
        "function-content-not-null": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "isNotNull"
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 1,
                    "maxItems": 1
                }
            },
            "additionalProperties": false
        },
        "function-content-equals-string": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "="
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 2,
                    "maxItems": 3
                }
            },
            "additionalProperties": false
        },
        "function-content-not-equal-to-string": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "fnApply"
                },
                "fnName": {
                    "type": "string",
                    "const": "notEqualTo"
                },
                "params": {
                    "type": "array",
                    "items": {
                        "$ref": "#/definitions/node-content"
                    },
                    "minItems": 2,
                    "maxItems": 3
                }
            },
            "additionalProperties": false
        },
        "function-creation-content": {
            "type": "object",
            "title": "Function Creation",
            "description": "Creates a function with a set of variables as parameters.",
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "nodeType": {
                            "type": "string",
                            "const": "fnCreate"
                        },
                        "params": {
                            "type": "array",
                            "items": {
                                "type": "object",
                                "properties": {
                                    "varName": {
                                        "type": "string"
                                    }
                                },
                                "required": [
                                    "varName"
                                ]
                            },
                            "minItems": 1
                        },
                        "body": {
                            "$ref": "#/definitions/function-application-content"
                        }
                    },
                    "required": [
                        "nodeType",
                        "params",
                        "body"
                    ]
                }
            ]
        },
        "field-lookup-content": {
            "type": "object",
            "title": "Field Accessor",
            "description": "An expression that is applied on an object and returns the value of the field specified in the expression.",
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "nodeType": {
                            "type": "string",
                            "const": "fieldLookup"
                        },
                        "fieldName": {
                            "type": "string"
                        },
                        "object": {
                            "$ref": "#/definitions/node-content"
                        }
                    },
                    "required": [
                        "nodeType",
                        "fieldName"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "literal-content": {
            "type": "object",
            "title": "Literal",
            "description": "A literal produces the value that is stated in the 'value' property.",
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "nodeType": {
                            "type": "string",
                            "const": "literal"
                        },
                        "literalType": {
                            "$ref": "#/definitions/literal-type"
                        }
                    },
                    "required": [
                        "nodeType",
                        "literalType"
                    ]
                },
                {
                    "oneOf": [
                        {
                            "$ref": "#/definitions/literal-string-content"
                        },
                        {
                            "$ref": "#/definitions/literal-number-content"
                        },
                        {
                            "$ref": "#/definitions/literal-integer-content"
                        },
                        {
                            "$ref": "#/definitions/literal-boolean-content"
                        },
                        {
                            "$ref": "#/definitions/literal-list-content"
                        },
                        {
                            "$ref": "#/definitions/literal-xdmobject-content"
                        }
                    ]
                }
            ]
        },
        "literal-string-content": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "literal"
                },
                "literalType": {
                    "type": "string",
                    "const": "String"
                },
                "value": {
                    "type": "string"
                }
            },
            "additionalProperties": false
        },
        "literal-number-content": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "literal"
                },
                "literalType": {
                    "type": "string",
                    "const": "Number"
                },
                "value": {
                    "type": "number"
                }
            },
            "additionalProperties": false
        },
        "literal-integer-content": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "literal"
                },
                "literalType": {
                    "type": "string",
                    "const": "Integer"
                },
                "value": {
                    "type": "integer"
                }
            },
            "additionalProperties": false
        },
        "literal-boolean-content": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "literal"
                },
                "literalType": {
                    "type": "string",
                    "const": "Boolean"
                },
                "value": {
                    "type": "boolean"
                }
            },
            "additionalProperties": false
        },
        "literal-list-content": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "literal"
                },
                "literalType": {
                    "type": "string",
                    "const": "List"
                },
                "value": {
                    "type": "array",
                    "items": {
                        "type": "string"
                    },
                    "minItems": 1
                }
            },
            "additionalProperties": false
        },
        "literal-xdmobject-content": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "literal"
                },
                "literalType": {
                    "type": "string",
                    "const": "XDMObject"
                },
                "value": {
                    "type": "string"
                }
            },
            "additionalProperties": false
        },
        "literal-query-string-content": {
            "type": "object",
            "properties": {
                "nodeType": {
                    "type": "string",
                    "const": "literal"
                },
                "literalType": {
                    "type": "string",
                    "const": "QueryString"
                },
                "value": {
                    "type": "string"
                }
            },
            "additionalProperties": false
        },
        "quantification-content": {
            "type": "object",
            "title": "Apply a Quantification",
            "description": "Produces a boolean value from a list of (tree-structured) input values by evaluating a predicate for each element. Depending on the quantifier 'all', 'some', 'none' or 'one' evaluations must result in `true` for the overall evaluation to become true.",
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "nodeType": {
                            "type": "string",
                            "const": "quantification"
                        },
                        "quantifier": {
                            "$ref": "#/definitions/quantifier-type"
                        },
                        "variables": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/variable-domain-content"
                            },
                            "minItems": 1
                        }
                    },
                    "required": [
                        "nodeType",
                        "quantifier",
                        "variables"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "select-expression-content": {
            "type": "object",
            "title": "Object Tree Evaluation",
            "description": "Produce a list of elements from a list of (tree-structured) input values by evaluating each clause in order of declaration. All clauses must evaluate to true for the element referenced in the first clause to qualify.",
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "nodeType": {
                            "type": "string",
                            "const": "select"
                        },
                        "variables": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/variable-domain-content"
                            },
                            "minItems": 1
                        }
                    },
                    "required": [
                        "nodeType",
                        "variables"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "variable-domain-content": {
            "type": "object",
            "title": "Define a variable and its domain",
            "description": "Produce a list of output values from a list of inputs by first applying an optional projection (from expression) and then a filter (where expression) to each value from the list of inputs. The list of values is bound to a variable name.",
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "nodeType": {
                            "type": "string",
                            "const": "varDecl"
                        },
                        "varName": {
                            "type": "string",
                            "pattern": "^[_A-Za-z0-9]+$"
                        },
                        "from": {
                            "$ref": "#/definitions/node-content"
                        },
                        "where": {
                            "$ref": "#/definitions/node-content"
                        }
                    },
                    "required": [
                        "nodeType",
                        "varName",
                        "from"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "variable-reference-content": {
            "type": "object",
            "title": "Reference to a value created in the context of a select expression evaluation",
            "description": "Produce a list of values by referencing a variable name that denotes a tree node element previously evaluated.",
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "nodeType": {
                            "type": "string",
                            "const": "varRef"
                        },
                        "varName": {
                            "type": "string",
                            "pattern": "^[_A-Za-z0-9]+$"
                        }
                    },
                    "required": [
                        "nodeType",
                        "varName"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "function-content-model-instances": {
            "type": "object",
            "title": "Reference all instances of a given model",
            "description": "Reference the instances of a given model provided by the execution context. The function takes one or more arguments, the first argument must evaluate to a string that results in the model name to be accessed.",
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "nodeType": {
                            "type": "string",
                            "const": "fnApply"
                        },
                        "fnName": {
                            "type": "string",
                            "const": "modelInstances"
                        },
                        "params": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/node-content"
                            },
                            "minItems": 1
                        }
                    },
                    "required": [
                        "nodeType",
                        "fnName",
                        "params"
                    ],
                    "additionalProperties": false
                }
            ]
        },
        "node-content": {
            "allOf": [
                {
                    "type": "object",
                    "properties": {
                        "nodeType": {
                            "$ref": "#/definitions/node-type"
                        }
                    },
                    "required": [
                        "nodeType"
                    ]
                },
                {
                    "oneOf": [
                        {
                            "$ref": "#/definitions/function-application-content"
                        },
                        {
                            "$ref": "#/definitions/function-creation-content"
                        },
                        {
                            "$ref": "#/definitions/literal-content"
                        },
                        {
                            "$ref": "#/definitions/field-lookup-content"
                        },
                        {
                            "$ref": "#/definitions/select-expression-content"
                        },
                        {
                            "$ref": "#/definitions/quantification-content"
                        },
                        {
                            "$ref": "#/definitions/variable-reference-content"
                        }
                    ]
                }
            ]
        }
    },
    "allOf": [
        {
            "$ref": "#/definitions/node-content"
        }
    ],
    "meta:status": "stable",
    "examples": [
        {
            "nodeType": "fnApply",
            "fnName": "modelInstances",
            "params": [
                {
                    "nodeType": "literal",
                    "literalType": "String",
                    "value": "/queries/offersByPlacementIds?placementId=\"uri:com:example:placement-01001\""
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "o",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "https://ns.adobe.com/experience/offer-management/personalized-offer"
                            }
                        ]
                    },
                    "where": {
                        "nodeType": "quantification",
                        "quantifier": "some",
                        "variables": [
                            {
                                "nodeType": "varDecl",
                                "varName": "r",
                                "from": {
                                    "nodeType": "fieldLookup",
                                    "fieldName": "xdm:representations",
                                    "object": {
                                        "nodeType": "varRef",
                                        "varName": "o"
                                    }
                                },
                                "where": {
                                    "nodeType": "fnApply",
                                    "fnName": "=",
                                    "params": [
                                        {
                                            "nodeType": "fieldLookup",
                                            "fieldName": "xdm:placement",
                                            "object": {
                                                "nodeType": "varRef",
                                                "varName": "r"
                                            }
                                        },
                                        {
                                            "nodeType": "literal",
                                            "literalType": "String",
                                            "value": "uri:com:example:placement-1001"
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                }
            ]
        },
        {
            "nodeType": "fnApply",
            "fnName": "modelInstances",
            "params": [
                {
                    "nodeType": "literal",
                    "literalType": "String",
                    "value": "/queries/offersByPlacementIds?placementId=\"uri:com:example:placement-01001\"&placementId=\"uri:com:example:placement-01002\""
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "o",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "https://ns.adobe.com/experience/offer-management/personalized-offer"
                            }
                        ]
                    },
                    "where": {
                        "nodeType": "quantification",
                        "quantifier": "some",
                        "variables": [
                            {
                                "nodeType": "varDecl",
                                "varName": "p",
                                "from": {
                                    "nodeType": "literal",
                                    "literalType": "List",
                                    "value": [
                                        "uri:com:example:placement-1001",
                                        "uri:com:example:placement-1002"
                                    ]
                                },
                                "where": {
                                    "nodeType": "fnApply",
                                    "fnName": "in",
                                    "params": [
                                        {
                                            "nodeType": "varRef",
                                            "varName": "p"
                                        },
                                        {
                                            "nodeType": "fieldLookup",
                                            "fieldName": "xdm:placement",
                                            "object": {
                                                "nodeType": "fieldLookup",
                                                "fieldName": "xdm:representations",
                                                "object": {
                                                    "nodeType": "varRef",
                                                    "varName": "o"
                                                }
                                            }
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "o",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "https://ns.adobe.com/experience/offer-management/personalized-offer"
                            }
                        ]
                    },
                    "where": {
                        "nodeType": "fnApply",
                        "fnName": "and",
                        "params": [
                            {
                                "nodeType": "quantification",
                                "quantifier": "some",
                                "variables": [
                                    {
                                        "nodeType": "varDecl",
                                        "varName": "p",
                                        "from": {
                                            "nodeType": "literal",
                                            "literalType": "List",
                                            "value": [
                                                "uri:com:example:placement-1001",
                                                "uri:com:example:placement-1002"
                                            ]
                                        },
                                        "where": {
                                            "nodeType": "fnApply",
                                            "fnName": "in",
                                            "params": [
                                                {
                                                    "nodeType": "varRef",
                                                    "varName": "p"
                                                },
                                                {
                                                    "nodeType": "fieldLookup",
                                                    "fieldName": "xdm:placement",
                                                    "object": {
                                                        "nodeType": "fieldLookup",
                                                        "fieldName": "xdm:representations",
                                                        "object": {
                                                            "nodeType": "varRef",
                                                            "varName": "o"
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "nodeType": "fnApply",
                                "fnName": "=",
                                "params": [
                                    {
                                        "nodeType": "fieldLookup",
                                        "fieldName": "xdm:status",
                                        "object": {
                                            "nodeType": "varRef",
                                            "varName": "o"
                                        }
                                    },
                                    {
                                        "nodeType": "literal",
                                        "literalType": "String",
                                        "value": "approved"
                                    }
                                ]
                            }
                        ]
                    }
                }
            ]
        },
        {
            "nodeType": "fnApply",
            "fnName": "modelInstances",
            "params": [
                {
                    "nodeType": "literal",
                    "literalType": "String",
                    "value": "/queries/offersByPlacementIds?placementId=\"uri:com:example:placement-01001\"&placementId=\"uri:com:example:placement-01002\"&property=\"_instance.status=approved\""
                }
            ]
        },
        {
            "nodeType": "fnApply",
            "fnName": "modelInstances",
            "params": [
                {
                    "nodeType": "literal",
                    "literalType": "String",
                    "value": "/queries/offersByTagIds?tagId=\"uri:com:example:tag-0001\""
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "o",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "https://ns.adobe.com/experience/offer-management/personalized-offer"
                            }
                        ]
                    },
                    "where": {
                        "nodeType": "fnApply",
                        "fnName": "in",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "uri:com:example:tag-0001"
                            },
                            {
                                "nodeType": "fieldLookup",
                                "fieldName": "xdm:tags",
                                "object": {
                                    "nodeType": "varRef",
                                    "varName": "o"
                                }
                            }
                        ]
                    }
                }
            ]
        },
        {
            "nodeType": "fnApply",
            "fnName": "modelInstances",
            "params": [
                {
                    "nodeType": "literal",
                    "literalType": "String",
                    "value": "/queries/offersByTagIds?tagId=\"uri:com:example:tag-0001\"&tagId=\"uri:com:example:tag-0002\""
                }
            ]
        },
        {
            "nodeType": "fnApply",
            "fnName": "modelInstances",
            "params": [
                {
                    "nodeType": "literal",
                    "literalType": "String",
                    "value": "/queries/offersByTagIds?tagId=\"uri:com:example:tag-0001\"&tagId=\"uri:com:example:tag-0002\"&qop=\"AND\""
                }
            ]
        },
        {
            "nodeType": "fnApply",
            "fnName": "modelInstances",
            "params": [
                {
                    "nodeType": "literal",
                    "literalType": "String",
                    "value": "/queries/offersByTagIds?tagId=\"uri:com:example:tag-0001\"&tagId=\"uri:com:example:tag-0002\"&qop=AND&property=`\"_instance.status=approved\""
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "o",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "https://ns.adobe.com/experience/offer-management/personalized-offer"
                            }
                        ]
                    },
                    "where": {
                        "nodeType": "fnApply",
                        "fnName": "and",
                        "params": [
                            {
                                "nodeType": "quantification",
                                "quantifier": "all",
                                "variables": [
                                    {
                                        "nodeType": "varDecl",
                                        "varName": "t",
                                        "from": {
                                            "nodeType": "literal",
                                            "literalType": "List",
                                            "value": [
                                                "uri:com:example:tag-0001",
                                                "uri:com:example:tag-0002"
                                            ]
                                        },
                                        "where": {
                                            "nodeType": "fnApply",
                                            "fnName": "in",
                                            "params": [
                                                {
                                                    "nodeType": "varRef",
                                                    "varName": "t"
                                                },
                                                {
                                                    "nodeType": "fieldLookup",
                                                    "fieldName": "xdm:tags",
                                                    "object": {
                                                        "nodeType": "varRef",
                                                        "varName": "o"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "nodeType": "fnApply",
                                "fnName": "=",
                                "params": [
                                    {
                                        "nodeType": "fieldLookup",
                                        "fieldName": "xdm:status",
                                        "object": {
                                            "nodeType": "varRef",
                                            "varName": "o"
                                        }
                                    },
                                    {
                                        "nodeType": "literal",
                                        "literalType": "String",
                                        "value": "approved"
                                    }
                                ]
                            }
                        ]
                    }
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "o",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "https://ns.adobe.com/experience/offer-management/personalized-offer"
                            }
                        ]
                    },
                    "where": {
                        "nodeType": "quantification",
                        "quantifier": "some",
                        "variables": [
                            {
                                "nodeType": "varDecl",
                                "varName": "t",
                                "from": {
                                    "nodeType": "literal",
                                    "literalType": "List",
                                    "value": [
                                        "uri:com:example:tag-0001",
                                        "uri:com:example:tag-0002"
                                    ]
                                },
                                "where": {
                                    "nodeType": "fnApply",
                                    "fnName": "in",
                                    "params": [
                                        {
                                            "nodeType": "varRef",
                                            "varName": "t"
                                        },
                                        {
                                            "nodeType": "fieldLookup",
                                            "fieldName": "xdm:tags",
                                            "object": {
                                                "nodeType": "varRef",
                                                "varName": "o"
                                            }
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "o",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "https://ns.adobe.com/experience/offer-management/personalized-offer"
                            }
                        ]
                    },
                    "where": {
                        "nodeType": "quantification",
                        "quantifier": "all",
                        "variables": [
                            {
                                "nodeType": "varDecl",
                                "varName": "t",
                                "from": {
                                    "nodeType": "literal",
                                    "literalType": "List",
                                    "value": [
                                        "uri:com:example:tag-0001",
                                        "uri:com:example:tag-0002"
                                    ]
                                },
                                "where": {
                                    "nodeType": "fnApply",
                                    "fnName": "in",
                                    "params": [
                                        {
                                            "nodeType": "varRef",
                                            "varName": "t"
                                        },
                                        {
                                            "nodeType": "fieldLookup",
                                            "fieldName": "xdm:tags",
                                            "object": {
                                                "nodeType": "varRef",
                                                "varName": "o"
                                            }
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "o",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "https://ns.adobe.com/experience/offer-management/personalized-offer"
                            },
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "?id=\"uri:com:example:offer-10001\"&id=\"uri:com:example:offer-10002\"&id=\"uri:com:example:offer-10004\"&id=\"uri:com:example:offer-10009\"&id=\"uri:com:example:offer-10013\"&id=\"uri:com:example:offer-10005\"&id=\"uri:com:example:offer-10022\""
                            },
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "?property=\"_instance.xdm:representations.xdm:placement=uri:com:example:placement-1001\""
                            },
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "?property=\"_instance.xdm:status=approved\""
                            }
                        ]
                    }
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "o",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "/queries/offersByTagIds?tagId=\"uri:com:example:tag-0001\"&tagId=\"uri:com:example:tag-0002\"&qop=AND&property=`\"_instance.status=approved\""
                            }
                        ]
                    },
                    "where": {
                        "nodeType": "quantification",
                        "quantifier": "some",
                        "variables": [
                            {
                                "nodeType": "varDecl",
                                "varName": "r",
                                "from": {
                                    "nodeType": "fieldLookup",
                                    "fieldName": "xdm:representations",
                                    "object": {
                                        "nodeType": "varRef",
                                        "varName": "o"
                                    }
                                },
                                "where": {
                                    "nodeType": "fnApply",
                                    "fnName": "=",
                                    "params": [
                                        {
                                            "nodeType": "fieldLookup",
                                            "fieldName": "xdm:placement",
                                            "object": {
                                                "nodeType": "varRef",
                                                "varName": "r"
                                            }
                                        },
                                        {
                                            "nodeType": "literal",
                                            "literalType": "String",
                                            "value": "uri:com:example:placement-1001"
                                        }
                                    ]
                                }
                            }
                        ]
                    }
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "o",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "https://ns.adobe.com/experience/offer-management/personalized-offer"
                            }
                        ]
                    },
                    "where": {
                        "nodeType": "fnApply",
                        "fnName": "and",
                        "params": [
                            {
                                "nodeType": "fnApply",
                                "fnName": "in",
                                "params": [
                                    {
                                        "nodeType": "fieldLookup",
                                        "fieldName": "xdm:@id",
                                        "object": {
                                            "nodeType": "varRef",
                                            "varName": "o"
                                        }
                                    },
                                    {
                                        "nodeType": "literal",
                                        "literalType": "List",
                                        "value": [
                                            "uri:com:example:offer-10001",
                                            "uri:com:example:offer-10002",
                                            "uri:com:example:offer-10004",
                                            "uri:com:example:offer-10009",
                                            "uri:com:example:offer-10013",
                                            "uri:com:example:offer-10005",
                                            "uri:com:example:offer-10022"
                                        ]
                                    }
                                ]
                            },
                            {
                                "nodeType": "quantification",
                                "quantifier": "some",
                                "variables": [
                                    {
                                        "nodeType": "varDecl",
                                        "varName": "r",
                                        "from": {
                                            "nodeType": "fieldLookup",
                                            "fieldName": "xdm:representations",
                                            "object": {
                                                "nodeType": "varRef",
                                                "varName": "o"
                                            }
                                        },
                                        "where": {
                                            "nodeType": "fnApply",
                                            "fnName": "=",
                                            "params": [
                                                {
                                                    "nodeType": "fieldLookup",
                                                    "fieldName": "xdm:placement",
                                                    "object": {
                                                        "nodeType": "varRef",
                                                        "varName": "r"
                                                    }
                                                },
                                                {
                                                    "nodeType": "literal",
                                                    "literalType": "String",
                                                    "value": "uri:com:example:placement-1001"
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "nodeType": "fnApply",
                                "fnName": "=",
                                "params": [
                                    {
                                        "nodeType": "fieldLookup",
                                        "fieldName": "xdm:status",
                                        "object": {
                                            "nodeType": "varRef",
                                            "varName": "o"
                                        }
                                    },
                                    {
                                        "nodeType": "literal",
                                        "literalType": "String",
                                        "value": "approved"
                                    }
                                ]
                            }
                        ]
                    }
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "p",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "https://ns.adobe.com/xdm/context/profile"
                            }
                        ]
                    },
                    "where": {
                        "nodeType": "fnApply",
                        "fnName": "or",
                        "params": [
                            {
                                "nodeType": "fnApply",
                                "fnName": "=",
                                "params": [
                                    {
                                        "nodeType": "fieldLookup",
                                        "fieldName": "xdm:firstName",
                                        "object": {
                                            "nodeType": "fieldLookup",
                                            "fieldName": "xdm:person",
                                            "object": {
                                                "nodeType": "varRef",
                                                "varName": "p"
                                            }
                                        }
                                    },
                                    {
                                        "literalType": "String",
                                        "nodeType": "literal",
                                        "value": "Dennis"
                                    }
                                ]
                            },
                            {
                                "nodeType": "fnApply",
                                "fnName": "=",
                                "params": [
                                    {
                                        "nodeType": "fieldLookup",
                                        "fieldName": "xdm:lastName",
                                        "object": {
                                            "nodeType": "fieldLookup",
                                            "fieldName": "xdm:person",
                                            "object": {
                                                "nodeType": "varRef",
                                                "varName": "p"
                                            }
                                        }
                                    },
                                    {
                                        "literalType": "String",
                                        "nodeType": "literal",
                                        "value": "Kehrig"
                                    }
                                ]
                            },
                            {
                                "nodeType": "quantification",
                                "quantifier": "all",
                                "variables": [
                                    {
                                        "nodeType": "varDecl",
                                        "varName": "x",
                                        "from": {
                                            "nodeType": "fnApply",
                                            "fnName": "modelInstances",
                                            "params": [
                                                {
                                                    "nodeType": "literal",
                                                    "literalType": "String",
                                                    "value": "https://ns.adobe.com/xdm/context/experienceevent"
                                                }
                                            ]
                                        },
                                        "where": {
                                            "nodeType": "fnApply",
                                            "fnName": "and",
                                            "params": [
                                                {
                                                    "nodeType": "quantification",
                                                    "quantifier": "some",
                                                    "variables": [
                                                        {
                                                            "nodeType": "varDecl",
                                                            "varName": "id",
                                                            "from": {
                                                                "nodeType": "fieldLookup",
                                                                "fieldName": "xdm:endUserIDs",
                                                                "object": {
                                                                    "nodeType": "varRef",
                                                                    "varName": "x"
                                                                }
                                                            },
                                                            "where": {
                                                                "nodeType": "fnApply",
                                                                "fnName": "in",
                                                                "params": [
                                                                    {
                                                                        "nodeType": "varRef",
                                                                        "varName": "id"
                                                                    },
                                                                    {
                                                                        "nodeType": "fieldLookup",
                                                                        "fieldName": "xdm:identities",
                                                                        "object": {
                                                                            "nodeType": "varRef",
                                                                            "varName": "p"
                                                                        }
                                                                    }
                                                                ]
                                                            }
                                                        }
                                                    ]
                                                },
                                                {
                                                    "nodeType": "fnApply",
                                                    "fnName": "=",
                                                    "params": [
                                                        {
                                                            "nodeType": "fieldLookup",
                                                            "fieldName": "xdm:city",
                                                            "object": {
                                                                "nodeType": "fieldLookup",
                                                                "fieldName": "xdm:geo",
                                                                "object": {
                                                                    "nodeType": "fieldLookup",
                                                                    "fieldName": "xdm:placecontext",
                                                                    "object": {
                                                                        "nodeType": "varRef",
                                                                        "varName": "x"
                                                                    }
                                                                }
                                                            }
                                                        },
                                                        {
                                                            "literalType": "String",
                                                            "nodeType": "literal",
                                                            "value": "Tky"
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                }
            ]
        },
        {
            "nodeType": "select",
            "variables": [
                {
                    "nodeType": "varDecl",
                    "varName": "o",
                    "from": {
                        "nodeType": "fnApply",
                        "fnName": "modelInstances",
                        "params": [
                            {
                                "nodeType": "literal",
                                "literalType": "String",
                                "value": "https://ns.adobe.com/experience/offer-management/personalized-offer"
                            }
                        ]
                    },
                    "where": {
                        "nodeType": "fnApply",
                        "fnName": "and",
                        "params": [
                            {
                                "nodeType": "quantification",
                                "quantifier": "all",
                                "variables": [
                                    {
                                        "nodeType": "varDecl",
                                        "varName": "_",
                                        "from": {
                                            "nodeType": "literal",
                                            "literalType": "List",
                                            "value": [
                                                "uri:com:example:tag-0001",
                                                "uri:com:example:tag-0002"
                                            ]
                                        },
                                        "where": {
                                            "nodeType": "fnApply",
                                            "fnName": "in",
                                            "params": [
                                                {
                                                    "nodeType": "varRef",
                                                    "varName": "_"
                                                },
                                                {
                                                    "nodeType": "fieldLookup",
                                                    "fieldName": "xdm:tags",
                                                    "object": {
                                                        "nodeType": "varRef",
                                                        "varName": "o"
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "nodeType": "quantification",
                                "quantifier": "some",
                                "variables": [
                                    {
                                        "nodeType": "varDecl",
                                        "varName": "_",
                                        "from": {
                                            "nodeType": "fieldLookup",
                                            "fieldName": "xdm:representations",
                                            "object": {
                                                "nodeType": "varRef",
                                                "varName": "o"
                                            }
                                        },
                                        "where": {
                                            "nodeType": "fnApply",
                                            "fnName": "=",
                                            "params": [
                                                {
                                                    "nodeType": "fieldLookup",
                                                    "fieldName": "xdm:placement",
                                                    "object": {
                                                        "nodeType": "varRef",
                                                        "varName": "_"
                                                    }
                                                },
                                                {
                                                    "nodeType": "literal",
                                                    "literalType": "String",
                                                    "value": "uri:com:example:placement-1001"
                                                }
                                            ]
                                        }
                                    }
                                ]
                            },
                            {
                                "nodeType": "fnApply",
                                "fnName": "=",
                                "params": [
                                    {
                                        "nodeType": "fieldLookup",
                                        "fieldName": "xdm:status",
                                        "object": {
                                            "nodeType": "varRef",
                                            "varName": "o"
                                        }
                                    },
                                    {
                                        "nodeType": "literal",
                                        "literalType": "String",
                                        "value": "approved"
                                    }
                                ]
                            }
                        ]
                    }
                }
            ]
        }
    ]
}